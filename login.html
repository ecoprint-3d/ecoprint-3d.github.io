<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ - –≠–∫–æ –ü—Ä–∏–Ω—Ç</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/login.css">
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E66PPP1FTP"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-E66PPP1FTP');
</script>
<body>
    <!-- –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ -->
    <div id="header"></div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ -->
    <section class="login-page">
        <div class="login-container">
            <div class="login-header">
                <h1>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h1>
                <p>–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏—Å—Ç–µ–º–µ</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" class="form-control" placeholder="–í–∞—à email" required value="ivanov@edu.ru">
                </div>
                
                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="password" class="form-control" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" required value="123">
                </div>
                
                <button type="submit" class="btn-login-form">–í–æ–π—Ç–∏</button>
                
                <div id="errorMessage" class="error-message">
                    –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å
                </div>
            </form>
            
            <div class="login-links">
                <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="register.html">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
            </div>

            <!-- –¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã -->
            <div class="test-accounts">
                <h3>–¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã:</h3>
                <div class="test-account">
                    <strong>–û–ø–µ—Ä–∞—Ç–æ—Ä:</strong> operator@ecoprint.ru / operator123
                </div>
                <div class="test-account">
                    <strong>–°—Ç—É–¥–µ–Ω—Ç:</strong> ivanov@edu.ru / 123
                </div>
                <div class="test-account">
                    <button onclick="showDebugInfo()" style="background: #666; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">
                        –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∏—Å—Ç–µ–º–µ
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- –ü–æ–¥–≤–∞–ª -->
    <div id="footer"></div>
    
    <script src="js/data.js"></script>
    <script>
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤–æ—à–µ–ª
            const currentUser = API.getCurrentUser();
            if (currentUser) {
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤–æ—à–µ–ª:', currentUser.name);
                redirectByRole(currentUser.role);
            }

            const form = document.getElementById('loginForm');
            const errorMessage = document.getElementById('errorMessage');

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                console.log('–ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ —Å email:', email);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                const submitBtn = form.querySelector('.btn-login-form');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = '–í—Ö–æ–¥...';
                submitBtn.disabled = true;
                errorMessage.style.display = 'none';
                
                try {
                    const user = await API.login(email, password);
                    
                    if (user) {
                        console.log('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user);
                        errorMessage.style.display = 'none';
                        redirectByRole(user.role);
                    } else {
                        errorMessage.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                        errorMessage.style.display = 'block';
                        console.log('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ:', error);
                    errorMessage.textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º';
                    errorMessage.style.display = 'block';
                } finally {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            });

            function redirectByRole(role) {
                console.log('–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Ä–æ–ª–∏:', role);
                if (role === 'operator') {
                    window.location.href = 'operator.html';
                } else {
                    window.location.href = 'index.html';
                }
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        async function showDebugInfo() {
            try {
                const users = await API.getUsers();
                const currentUser = API.getCurrentUser();
                
                let message = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ: ${users.length}\n\n`;
                users.forEach(user => {
                    message += `üë§ ${user.name} (${user.email})\n`;
                    message += `   –†–æ–ª—å: ${user.role}\n`;
                    message += `   –ë–∞–ª–∞–Ω—Å: ${user.bonusBalance} –±–∞–ª–ª–æ–≤\n`;
                    message += `   ID: ${user.id}\n\n`;
                });
                
                if (currentUser) {
                    message += `–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${currentUser.name} (${currentUser.role})`;
                } else {
                    message += '–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                }
                
                alert(message);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ');
            }
        }
    </script>
</body>
</html>